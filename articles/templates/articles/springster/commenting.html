{% load wagtailcore_tags article_tags theme_tags home_tags i18n comments %}


<div class="commenting commenting--on-article">
    <div class="heading heading--component">
        <h1 class="heading__component-title">{% trans 'Share your feedback' %}</h1>
    </div>
    {% get_comment_form for comment as form %}
    {% if user.is_authenticated %}
        
        
        <form action="{% comment_form_target %}" method="POST" class="commenting-form">
        {% csrf_token %}
            {{ form.comment }}
            {{ form.content_type }}
            {{ form.object_pk }}
            {{ form.security_hash }}
            {{ form.timestamp }}
            <input type="hidden" name="next" value="{{ page.url }}" />
            <input type="hidden" name="email" value="comment@example.com" />
            <input type="hidden" name="parent" value="{{comment.pk}}" />
            <input type="submit" value="Add comment" id="id_submit" class="call-to-action__submit" />
        </form>
    {% else %}
        <div class="heading heading--component">
            <h1 class="heading__component-title">{% trans 'Your thoughts' %}</h1>
        </div>
        <div class="call-to-action">
            <a href="{% url 'auth_login' %}" class="call-to-action__submit">Log in to leave a comment</a>
        </div>
    {% endif %}

    

    {% get_comment_list for page as comment_list %}
    {% for comment in comment_list %}
        <p>Posted by: {{ comment.user_name }}</p>
        <p>Comment: {{ comment.comment }}</p>
        {% get_comment_list for comment as threaded_comment_list %}
        {% get_comment_count for comment as reply_count %}
        <p>{{ reply_count }} replies have been posted.</p>
        {% for threaded_comment in threaded_comment_list %}
            <p>Posted by: {{ threaded_comment.user_name }}</p>
            <p>Comment: {{ threaded_comment.comment }}</p>
        {% endfor %}
        <a href="/comments/flag/{{ comment.id }}/">Flag comment</a> 
    {% endfor %}

</div>
